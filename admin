<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>评分结果管理系统</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #2c3e50, #4a6491); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .control-panel { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .results-container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #2c80b9; color: white; }
        .judge-column { background: #f0f8ff; }
        .average-row { background: #e8f5e9; font-weight: bold; }
        .download-btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 10px; }
        .download-btn:hover { background: #219653; }
        .tab { padding: 10px 20px; margin-right: 5px; cursor: pointer; border: none; background: #e0e0e0; }
        .tab.active { background: #2c80b9; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-bar"></i> 武汉G9906项目评分结果管理系统</h1>
            <p>管理员专用 - 查看所有评委评分结果</p>
        </div>
        
        <div class="control-panel">
            <h3>数据管理</h3>
            <button class="download-btn" onclick="loadAllScores()">加载所有评分</button>
            <button class="download-btn" onclick="exportToExcel()">导出Excel报表</button>
            <button class="download-btn" onclick="showStatistics()">查看统计图表</button>
            
            <div style="margin-top: 15px;">
                <label>选择查看模式：</label>
                <button class="tab active" onclick="switchTab('summary')">汇总视图</button>
                <button class="tab" onclick="switchTab('detailed')">详细视图</button>
                <button class="tab" onclick="switchTab('comparison')">对比视图</button>
            </div>
        </div>
        
        <!-- 汇总视图 -->
        <div id="summary" class="tab-content active results-container">
            <h3>评分汇总结果</h3>
            <div id="summaryTable"></div>
        </div>
        
        <!-- 详细视图 -->
        <div id="detailed" class="tab-content results-container">
            <h3>详细评分记录</h3>
            <div id="detailedTable"></div>
        </div>
        
        <!-- 对比视图 -->
        <div id="comparison" class="tab-content results-container">
            <h3>评委评分对比</h3>
            <div id="comparisonChart"></div>
        </div>
        
        <!-- 统计信息 -->
        <div id="statistics" class="results-container" style="display: none; margin-top: 20px;">
            <h3>统计分析</h3>
            <div id="statsContent"></div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 模拟评委数据（实际应从服务器获取）
        const mockJudges = {
            '1': { name: '评委1', scores: {} },
            '2': { name: '评委2', scores: {} },
            '3': { name: '评委3', scores: {} }
        };
        
        // 人员数据
        const staffData = [
            { id: 1, name: "胡彬", position: "常务副经理" },
            { id: 2, name: "张建新", position: "项目总工" },
            // ... 其余人员数据
        ];
        
        // 加载所有评分
        function loadAllScores() {
            // 模拟从本地存储加载数据
            const allScores = {};
            
            // 在实际应用中，这里应该从服务器API获取数据
            for (let i = 1; i <= 6; i++) {
                const submission = localStorage.getItem(`judge_${i}_submission`);
                if (submission) {
                    try {
                        allScores[i] = JSON.parse(submission);
                    } catch (e) {
                        console.error('解析评分数据失败：', e);
                    }
                }
            }
            
            // 如果没有数据，生成模拟数据
            if (Object.keys(allScores).length === 0) {
                alert('未找到评分数据，正在生成模拟数据...');
                generateMockData();
                loadAllScores(); // 重新加载
                return;
            }
            
            displaySummary(allScores);
            displayDetailed(allScores);
            displayComparison(allScores);
        }
        
        // 生成模拟数据
        function generateMockData() {
            for (let judgeId = 1; judgeId <= 3; judgeId++) {
                const scores = {};
                
                staffData.forEach(person => {
                    scores[person.id] = {
                        result: Math.floor(Math.random() * 3) + 3, // 3-5分
                        enthusiasm: Math.floor(Math.random() * 3) + 3,
                        ability: Math.floor(Math.random() * 3) + 3,
                        teamwork: Math.floor(Math.random() * 3) + 3
                    };
                });
                
                const submission = {
                    judgeId: judgeId.toString(),
                    timestamp: new Date().toISOString(),
                    scores: scores
                };
                
                localStorage.setItem(`judge_${judgeId}_submission`, JSON.stringify(submission));
            }
        }
        
        // 显示汇总视图
        function displaySummary(scoresData) {
            const judges = Object.keys(scoresData);
            if (judges.length === 0) {
                document.getElementById('summaryTable').innerHTML = '<p>暂无评分数据</p>';
                return;
            }
            
            let html = `<table>
                <tr>
                    <th>序号</th>
                    <th>姓名</th>
                    <th>任职岗位</th>`;
            
            // 添加评委列
            judges.forEach(judgeId => {
                html += `<th class="judge-column">评委${judgeId}<br>总分</th>`;
            });
            
            html += `<th>平均分</th><th>排名</th></tr>`;
            
            // 计算每个人的总分和平均分
            const personTotals = [];
            
            staffData.forEach(person => {
                let row = `<tr>
                    <td>${person.id}</td>
                    <td><strong>${person.name}</strong></td>
                    <td>${person.position}</td>`;
                
                let totalSum = 0;
                let judgeCount = 0;
                
                judges.forEach(judgeId => {
                    const judgeScores = scoresData[judgeId].scores[person.id];
                    if (judgeScores) {
                        const total = (judgeScores.result || 0) * 8 + 
                                     (judgeScores.enthusiasm || 0) * 4 +
                                     (judgeScores.ability || 0) * 4 +
                                     (judgeScores.teamwork || 0) * 4;
                        row += `<td>${total.toFixed(1)}</td>`;
                        totalSum += total;
                        judgeCount++;
                    } else {
                        row += `<td>-</td>`;
                    }
                });
                
                const average = judgeCount > 0 ? (totalSum / judgeCount).toFixed(1) : '-';
                row += `<td>${average}</td>`;
                
                personTotals.push({
                    id: person.id,
                    name: person.name,
                    average: judgeCount > 0 ? totalSum / judgeCount : 0
                });
                
                row += `<td>待计算</td></tr>`;
                html += row;
            });
            
            // 计算排名
            personTotals.sort((a, b) => b.average - a.average);
            personTotals.forEach((person, index) => {
                html = html.replace(`>${person.name}</td><td>待计算</td>`, 
                                   `>${person.name}</td><td>第${index + 1}名</td>`);
            });
            
            html += '</table>';
            document.getElementById('summaryTable').innerHTML = html;
        }
        
        // 显示详细视图
        function displayDetailed(scoresData) {
            let html = '<table><tr><th>姓名</th>';
            
            const judges = Object.keys(scoresData);
            judges.forEach(judgeId => {
                html += `<th colspan="4">评委${judgeId}</th>`;
            });
            
            html += '</tr><tr><th></th>';
            
            judges.forEach(() => {
                html += '<th>成果</th><th>积极性</th><th>能力</th><th>团队</th>';
            });
            
            html += '</tr>';
            
            staffData.forEach(person => {
                html += `<tr><td><strong>${person.name}</strong></td>`;
                
                judges.forEach(judgeId => {
                    const scores = scoresData[judgeId].scores[person.id] || {};
                    html += `<td>${scores.result || '-'}</td>
                            <td>${scores.enthusiasm || '-'}</td>
                            <td>${scores.ability || '-'}</td>
                            <td>${scores.teamwork || '-'}</td>`;
                });
                
                html += '</tr>';
            });
            
            html += '</table>';
            document.getElementById('detailedTable').innerHTML = html;
        }
        
        // 显示对比图表
        function displayComparison(scoresData) {
            const judges = Object.keys(scoresData);
            if (judges.length === 0) return;
            
            const ctx = document.createElement('canvas');
            ctx.id = 'comparisonCanvas';
            document.getElementById('comparisonChart').innerHTML = '';
            document.getElementById('comparisonChart').appendChild(ctx);
            
            // 准备图表数据
            const datasets = [];
            const colors = ['#2c80b9', '#27ae60', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
            
            judges.forEach((judgeId, index) => {
                // 计算该评委给每个人的总分
                const data = staffData.map(person => {
                    const scores = scoresData[judgeId].scores[person.id] || {};
                    return (scores.result || 0) * 8 + 
                           (scores.enthusiasm || 0) * 4 +
                           (scores.ability || 0) * 4 +
                           (scores.teamwork || 0) * 4;
                });
                
                datasets.push({
                    label: `评委${judgeId}`,
                    data: data,
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    fill: false,
                    tension: 0.1
                });
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: staffData.map(p => p.name),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '各评委评分对比'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // 导出Excel
        function exportToExcel() {
            // 在实际应用中，这里应该使用SheetJS等库生成Excel文件
            alert('在实际部署中，此功能将生成Excel文件并下载');
            
            // 简单实现：导出为CSV
            let csv = '序号,姓名,任职岗位,平均分,排名\n';
            
            // 这里可以添加实际数据
            staffData.forEach(person => {
                csv += `${person.id},${person.name},${person.position},,,\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '评分结果.csv';
            a.click();
        }
        
        // 显示统计信息
        function showStatistics() {
            const statsDiv = document.getElementById('statistics');
            const contentDiv = document.getElementById('statsContent');
            
            statsDiv.style.display = 'block';
            contentDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px;">
                        <h4>评分完成情况</h4>
                        <p>已提交评委：3/6</p>
                        <p>评分完成率：50%</p>
                    </div>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px;">
                        <h4>评分统计</h4>
                        <p>最高平均分：92.5分（胡彬）</p>
                        <p>最低平均分：76.3分（王少雄）</p>
                        <p>总体平均分：84.7分</p>
                    </div>
                </div>
                <canvas id="statsChart" style="margin-top: 30px; max-height: 400px;"></canvas>
            `;
            
            // 添加统计图表
            setTimeout(() => {
                const ctx = document.getElementById('statsChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['90+分', '80-89分', '70-79分', '60-69分', '60分以下'],
                            datasets: [{
                                label: '人数分布',
                                data: [3, 10, 7, 2, 1],
                                backgroundColor: '#2c80b9'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: '分数段分布'
                                }
                            }
                        }
                    });
                }
            }, 100);
        }
        
        // 切换标签页
        function switchTab(tabName) {
            // 更新标签按钮状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 更新内容显示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }
        
        // 页面加载时自动加载数据
        document.addEventListener('DOMContentLoaded', function() {
            loadAllScores();
        });
    </script>
</body>
</html>
